(function ()
{
  'use strict';

  angular
    .module('app.coupon')
    .controller('autoGenerateCouponController', autoGenerateCouponController);

  /** @ngInject */
  function autoGenerateCouponController($mdDialog, $scope,$charge,notifications,coupon)
  {
    var vm = this;
    $scope.couponCount = 1;

    $scope.submitCouponCount = function () {
       // debugger;
      if($scope.couponCountForm.$valid){

        coupon.generateCount = $scope.couponCount;
        coupon.isDirectFromInsert = "false";

        $charge.coupon().store(coupon).success(function (data) {

          if (data.error == "00000") {
            //
            notifications.toast("Record Saved, Auto generate Coupon(s) Added", 'success');


           $mdDialog.hide();

            $charge.coupon().getAutoGeneratedCoupons(coupon.couponcode).success(function (data) {

              $("#myTable tr").remove();

              for (var i = 0; i < data.length; i++) {
                var table = document.getElementById("myTable");
                var row = table.insertRow(i);
                var cell1 = row.insertCell(0);
                cell1.innerHTML = data[i].couponcode;
              }

              var report = new Blob([document.getElementById('mainDiv').innerHTML], {
                type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"
              });

              saveAs(report, "CloudCharge.xls");

            }).error(function (data) {

            })


          }
        }).error(function (data) {

          // console.log(data);

          $scope.isSaveClicked = false;

          notifications.toast("Error adding record, " + data['error'], "error");

        })




      }
    }

    $scope.closeDialog = function () {
      $mdDialog.hide();
    }
  }
})();
